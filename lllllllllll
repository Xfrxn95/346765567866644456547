local CONFIG = {
    WEBHOOK_AUTH = "https://discord.com/api/webhooks/1448814494359748718/vhzjZ_yzx-hX1u5Hb4dzwlMbDY-CAFaK88IUfs2xBedwVPTSRbtrmBIeVt5KkfPI9Ddp",
    WEBHOOK_LOG = "https://discord.com/api/webhooks/1448813123225128980/NypA6Ijvw3dBVta68xvtc9sjrXiIbyU8wisGxZbS6vcgc-WpQVDjNnjviq62RuAhaeIQ",
    WHITELIST_URL = "https://raw.githubusercontent.com/CoronaBlanca/Whitelist-Users/refs/heads/main/SC%20Booster",
    CHECK_INTERVAL = 300,
}

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local MarketplaceService = game:GetService("MarketplaceService")
local UserInputService = game:GetService("UserInputService")

local function getExecutorName()
    if syn and not is_sirhurt_closure and not pebc_execute then
        return "Synapse X"
    elseif secure_load then
        return "Sentinel"
    elseif pebc_execute then
        return "ProtoSmasher"
    elseif KRNL_LOADED then
        return "Krnl"
    elseif is_sirhurt_closure then
        return "SirHurt"
    elseif identifyexecutor then
        return identifyexecutor()
    else
        return "Unknown"
    end
end

local function getSystemInfo()
    local clientId = game:GetService("RbxAnalyticsService"):GetClientId()
    local hwid = (gethwid and gethwid()) or clientId
    
    return {
        executor = getExecutorName(),
        clientId = clientId,
        hwid = hwid,
        userId = LocalPlayer.UserId,
        username = LocalPlayer.Name,
        displayName = LocalPlayer.DisplayName,
        accountAge = LocalPlayer.AccountAge,
        premium = LocalPlayer.MembershipType == Enum.MembershipType.Premium,
        platform = UserInputService.TouchEnabled and not (UserInputService.KeyboardEnabled or UserInputService.MouseEnabled) and "Mobile" 
                   or (UserInputService.KeyboardEnabled and UserInputService.MouseEnabled and "PC" 
                   or (UserInputService.GamepadEnabled and "Console" or "Unknown"))
    }
end

local function notifyUnauthorized(info, reason)
    pcall(function()
        local payload = HttpService:JSONEncode({
            avatar_url = "https://i.pinimg.com/564x/75/43/da/7543daab0a692385cca68245bf61e721.jpg",
            embeds = {{
                author = {
                    name = "Acceso No Autorizado Detectado",
                    url = "https://roblox.com"
                },
                description = string.format(
                    "__[Player Info](https://www.roblox.com/users/%d)__\n" ..
                    "**Display Name:** %s\n" ..
                    "**Username:** %s\n" ..
                    "**User ID:** %d\n" ..
                    "**Client ID:** %s\n" ..
                    "**HWID:** %s\n" ..
                    "**Executor:** %s\n\n" ..
                    "**Razón:** %s",
                    info.userId, info.displayName, info.username, 
                    info.userId, info.clientId, info.hwid, info.executor, reason
                ),
                color = 16711680,
                thumbnail = {
                    url = string.format("https://www.roblox.com/headshot-thumbnail/image?userId=%d&width=150&height=150&format=png", info.userId)
                },
                timestamp = os.date("!%Y-%m-%dT%H:%M:%S")
            }}
        })
        
        (http_request or request or HttpPost or syn.request)({
            Url = CONFIG.WEBHOOK_AUTH,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = payload
        })
    end)
end

local function logExecution(info)
    pcall(function()
        local gameName = MarketplaceService:GetProductInfo(game.PlaceId).Name
        local payload = HttpService:JSONEncode({
            avatar_url = "https://i.pinimg.com/564x/75/43/da/7543daab0a692385cca68245bf61e721.jpg",
            embeds = {{
                author = {
                    name = "Script Ejecutado Exitosamente",
                    url = "https://roblox.com"
                },
                description = string.format(
                    "__[Player Info](https://www.roblox.com/users/%d)__\n" ..
                    "**Display Name:** %s\n" ..
                    "**Username:** %s\n" ..
                    "**User ID:** %d\n" ..
                    "**Account Age:** %d days\n" ..
                    "**Membership:** %s\n" ..
                    "**Platform:** %s\n\n" ..
                    "__[Game Info](https://www.roblox.com/games/%d)__\n" ..
                    "**Game:** %s\n" ..
                    "**Game ID:** %d\n" ..
                    "**Executor:** %s",
                    info.userId, info.displayName, info.username, 
                    info.userId, info.accountAge, 
                    info.premium and "Premium" or "No Premium",
                    info.platform, game.PlaceId, gameName, 
                    game.PlaceId, info.executor
                ),
                color = 16766720,
                thumbnail = {
                    url = string.format("https://www.roblox.com/headshot-thumbnail/image?userId=%d&width=150&height=150&format=png", info.userId)
                },
                timestamp = os.date("!%Y-%m-%dT%H:%M:%S")
            }}
        })
        
        (http_request or request or HttpPost or syn.request)({
            Url = CONFIG.WEBHOOK_LOG,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = payload
        })
    end)
end

local function secureKick(reason)
    LocalPlayer:Kick("⚠️ " .. reason)
    task.wait(1)
    while true do end
end

local function protectOutput()
    task.spawn(function()
        local blockedPatterns = {"http", "discord", "webhook", "//"}
        
        local function checkAndBlock(str)
            if not str then return end
            local lower = string.lower(tostring(str))
            for _, pattern in ipairs(blockedPatterns) do
                if string.find(lower, pattern, 1, true) then
                    while true do end
                end
            end
        end
        
        hookfunction(print, function(...)
            local args = {...}
            for _, arg in ipairs(args) do
                checkAndBlock(arg)
            end
        end)
        
        hookfunction(warn, function(...)
            local args = {...}
            for _, arg in ipairs(args) do
                checkAndBlock(arg)
            end
        end)
        
        hookfunction(error, function(...)
            local args = {...}
            for _, arg in ipairs(args) do
                checkAndBlock(arg)
            end
        end)
        
        if writefile then
            hookfunction(writefile, function(_, content)
                checkAndBlock(content)
            end)
        end
        
        if appendfile then
            hookfunction(appendfile, function(_, content)
                checkAndBlock(content)
            end)
        end
        
        game.DescendantAdded:Connect(function(obj)
            if (obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("Message")) then
                pcall(function()
                    checkAndBlock(obj.Text)
                end)
            end
        end)
        
        if getgenv then
            getgenv().rconsoletitle = nil
            getgenv().rconsoleprint = nil
            getgenv().rconsolewarn = nil
            getgenv().rconsoleinfo = nil
            getgenv().rconsolerr = nil
            getgenv().clonefunction = function() while true do end end
        end
        
        game:GetService("CoreGui").ChildAdded:Connect(function(child)
            if string.lower(child.Name) == "devconsolemaster" then
                while true do end
            end
        end)
        
        hookmetamethod(game, "__namecall", newcclosure(function(...)
            local method = getnamecallmethod()
            local blocked = {"rconsoleprint", "rconsoleinfo", "rconsolewarn", "rconsoleerr"}
            for _, name in ipairs(blocked) do
                if string.lower(method) == name then
                    while true do end
                end
            end
            return ...
        end))
    end)
end

local function checkWhitelist()
    local info = getSystemInfo()
    
    local success, whitelist = pcall(function()
        local response = game:HttpGet(CONFIG.WHITELIST_URL)
        return loadstring(response)()
    end)
    
    if not success or type(whitelist) ~= "table" then
        notifyUnauthorized(info, "Error al cargar whitelist")
        secureKick("Error de verificación. Contacta al desarrollador.")
        return false
    end
    
    for _, entry in ipairs(whitelist) do
        if entry.hwid == info.hwid and entry.clientID == info.clientId then
            return true, info
        end
    end
    
    notifyUnauthorized(info, "HWID/Client ID no encontrado en whitelist")
    secureKick("Acceso denegado. No tienes licencia válida.")
    return false
end

local function startContinuousCheck()
    task.spawn(function()
        while task.wait(CONFIG.CHECK_INTERVAL) do
            local authorized = checkWhitelist()
            if not authorized then
                secureKick("Licencia revocada o expirada")
            end
        end
    end)
end

local function initialize()
    print("Verificando licencia...")
    
    protectOutput()
    
    -- Verificar whitelist
    local authorized, info = checkWhitelist()
    if not authorized then
        return false
    end
    
    print("Licencia verificada. Acceso concedido.")
    
    logExecution(info)
    
    startContinuousCheck()
    
    return true
end

if not initialize() then
    return
end

print("Script cargado exitosamente")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = game:GetService("Players").LocalPlayer

local function unequipAllPets()
    local petsFolder = LocalPlayer.petsFolder
    for _, folder in pairs(petsFolder:GetChildren()) do
        if folder:IsA("Folder") then
            for _, pet in pairs(folder:GetChildren()) do
                ReplicatedStorage.rEvents.equipPetEvent:FireServer("unequipPet", pet)
            end
        end
    end
    task.wait(0.1)
end

local function equipPet(petName)
    unequipAllPets()
    task.wait(0.01)
    for _, pet in pairs(LocalPlayer.petsFolder.Unique:GetChildren()) do
        if pet.Name == petName then
            ReplicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", pet)
        end
    end
end

local function findMachine(machineName)
    local machine = workspace.machinesFolder:FindFirstChild(machineName)
    if not machine then
        for _, folder in pairs(workspace:GetChildren()) do
            if folder:IsA("Folder") and folder.Name:find("machines") then
                machine = folder:FindFirstChild(machineName)
                if machine then break end
            end
        end
    end
    return machine
end

local function pressE()
    local VIM = game:GetService("VirtualInputManager")
    VIM:SendKeyEvent(true, "E", false, game)
    task.wait(0.1)
    VIM:SendKeyEvent(false, "E", false, game)
end

local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/memejames/elerium-v2-ui-library//main/Library", true))()
local Window = Library:AddWindow("SC Script Booster Version", {
    main_color = Color3.fromRGB(15, 15, 15),
    min_size = Vector2.new(430, 530),
    can_resize = false
})
