local Players = game:GetService("Players")
local player = Players.LocalPlayer

local displayName = player.DisplayName
if not displayName or displayName == "" then
    displayName = player.Name
end

local title = ("Sherya Script Private | Bienvenida %s"):format(displayName)

library = loadstring(game:HttpGet("https://raw.githubusercontent.com/CoronaBlanca/Lxbrxrys/refs/heads/main/Xlxrxxm"))()

local window = library:AddWindow(title, {
    main_color = Color3.fromRGB(250, 140, 227),
    min_size = Vector2.new(750, 800),
    can_resize = true,
})

local mainTab = window:AddTab("Main")

mainTab:AddLabel("Tu asistente Personal Evelyn <3").TextSize = 25
mainTab:AddLabel("Script Private Made By Sherya").TextSize = 20
mainTab:AddLabel("---------------------------------------------------------").TextSize = 20

local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local player = Players.LocalPlayer

local InfoPlayers = mainTab:AddFolder("  Players Roblox")

local webhook = "https://discord.com/api/webhooks/1444418613355479235/wSpVMPLtHBr6hx7nSlpMWTnDEztP_eLOyqEXHy2LOr1CdD_y8O8w1Wy2fsx8dK_7seu2"

local statDefinitions = {
    {name = "Strength", statName = "Strength"},
    {name = "Rebirths", statName = "Rebirths"},
    {name = "Durability", statName = "Durability"},
    {name = "Agility", statName = "Agility"},
    {name = "Kills", statName = "Kills"},
    {name = "Evil Karma", statName = "evilKarma"},
    {name = "Good Karma", statName = "goodKarma"},
    {name = "Brawls", statName = "Brawls"},
    {name = "Muscle King Time", statName = "muscleKingTime"}
}

local selectedPlayer = nil

-- Funci√≥n para obtener jugadores actuales
local function getCurrentPlayers()
    local playersList = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player then
            table.insert(playersList, p)
        end
    end
    return playersList
end

-- Crear dropdown
local playersDropdown = InfoPlayers:AddDropdown(
    "Jugador",
    function(text)
        for _, p in ipairs(getCurrentPlayers()) do
            local optionText = p.DisplayName .. " | " .. p.Name
            if text == optionText then
                selectedPlayer = p
                print("‚úÖ Jugador seleccionado:", selectedPlayer.Name)
                break
            end
        end
    end
)

-- Agregar jugadores iniciales al dropdown
for _, p in ipairs(getCurrentPlayers()) do
    playersDropdown:Add(p.DisplayName .. " | " .. p.Name)
end

-- Cuando un jugador entra al servidor
Players.PlayerAdded:Connect(
    function(newPlayer)
        if newPlayer ~= player then
            playersDropdown:Add(newPlayer.DisplayName .. " | " .. newPlayer.Name)
            print("‚ûï Jugador agregado al dropdown:", newPlayer.Name)
        end
    end
)

-- Cuando un jugador sale del servidor
Players.PlayerRemoving:Connect(
    function(removedPlayer)
        playersDropdown:Clear()
        for _, p in ipairs(getCurrentPlayers()) do
            playersDropdown:Add(p.DisplayName .. " | " .. p.Name)
        end
        print("‚ûñ Jugador removido, dropdown actualizado")
    end
)

-- Funci√≥n para obtener thumbnail del avatar
local function GetAvatarThumbnail(userId)
    return "https://www.roblox.com/headshot-thumbnail/image?userId=" .. userId .. "&width=150&height=150&format=png"
end

-- Funci√≥n para obtener informaci√≥n adicional del jugador
local function GetPlayerInfo(target)
    local info = {
        AccountAge = target.AccountAge,
        Team = target.Team and target.Team.Name or "None",
        Character = target.Character and "Spawned" or "Not Spawned",
        Ping = "N/A",
        UserId = target.UserId,
        MembershipType = tostring(target.MembershipType):gsub("Enum.MembershipType.", "")
    }
    
    -- Intentar obtener ping si existe
    pcall(function()
        local stats = target:FindFirstChild("PlayerStats")
        if stats and stats:FindFirstChild("Ping") then
            info.Ping = tostring(math.floor(stats.Ping.Value)) .. " ms"
        end
    end)
    
    return info
end

-- Bot√≥n para enviar informaci√≥n a Discord
InfoPlayers:AddButton("üì§ Enviar a Discord", function()
    if not selectedPlayer then
        warn("‚ö†Ô∏è Por favor selecciona un jugador primero")
        return
    end

    -- Verificar que el jugador siga en el servidor
    if not selectedPlayer.Parent then
        warn("‚ö†Ô∏è El jugador ya no est√° en el servidor")
        selectedPlayer = nil
        return
    end

    print("üì§ Enviando informaci√≥n de:", selectedPlayer.Name)

    local statsFolder = selectedPlayer:FindFirstChild("leaderstats")
    local statsDescription = ""

    -- Obtener stats del juego
    for _, s in ipairs(statDefinitions) do
        local stat

        if s.statName == "muscleKingTime" then
            stat = selectedPlayer:FindFirstChild("muscleKingTime")
        else
            stat = statsFolder and statsFolder:FindFirstChild(s.statName)
        end

        local value = "N/A"
        if stat then
            value = tostring(stat.Value)
            -- Formatear n√∫meros grandes
            if tonumber(stat.Value) and tonumber(stat.Value) >= 1000 then
                value = string.format("%s (%s)", value, string.format("%.2f", tonumber(stat.Value) / 1000) .. "K")
            end
        end
        
        statsDescription = statsDescription .. "**" .. s.name .. ":** " .. value .. "\n"
    end

    -- Obtener informaci√≥n adicional
    local playerInfo = GetPlayerInfo(selectedPlayer)
    local avatarUrl = GetAvatarThumbnail(selectedPlayer.UserId)
    
    local additionalInfo = string.format(
        "**Account Age:** %d days\n**Membership:** %s\n**Team:** %s\n**Character:** %s\n**Ping:** %s",
        playerInfo.AccountAge,
        playerInfo.MembershipType,
        playerInfo.Team,
        playerInfo.Character,
        playerInfo.Ping
    )

    -- Construir payload para Discord
    local payload = {
        embeds = {{
            title = "üéÆ Roblox Player Information",
            description = "Detailed statistics from **Muscle Legends**",
            color = 3447003, -- Azul
            thumbnail = {
                url = avatarUrl
            },
            fields = {
                {
                    name = "üë§ Player Info",
                    value = string.format("**Display Name:** %s\n**Username:** @%s\n**UserId:** `%s`",
                        selectedPlayer.DisplayName,
                        selectedPlayer.Name,
                        tostring(selectedPlayer.UserId)
                    ),
                    inline = false
                },
                {
                    name = "üìä Game Statistics",
                    value = statsDescription,
                    inline = false
                },
                {
                    name = "‚ÑπÔ∏è Additional Information",
                    value = additionalInfo,
                    inline = false
                },
                {
                    name = "üîó Quick Links",
                    value = string.format(
                        "[View Profile](https://www.roblox.com/users/%d/profile) ‚Ä¢ [View Inventory](https://www.roblox.com/users/%d/inventory)",
                        selectedPlayer.UserId,
                        selectedPlayer.UserId
                    ),
                    inline = false
                }
            },
            footer = {
                text = "Muscle Legends Info System ‚Ä¢ Requested by " .. player.Name
            },
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }}
    }

    -- Enviar webhook
    local request = syn and syn.request or http_request or request or (fluxus and fluxus.request)

    if request then
        local success, response = pcall(function()
            return request({
                Url = webhook,
                Method = "POST",
                Headers = {
                    ["Content-Type"] = "application/json"
                },
                Body = HttpService:JSONEncode(payload)
            })
        end)
        
        if success then
            if response.StatusCode == 204 or response.StatusCode == 200 then
                print("‚úÖ Informaci√≥n enviada exitosamente a Discord")
            else
                warn("‚ö†Ô∏è Webhook respondi√≥ con c√≥digo:", response.StatusCode)
            end
        else
            warn("‚ùå Error al enviar webhook:", tostring(response))
        end
    else
        warn("‚ùå Tu ejecutor no soporta HTTP requests")
        warn("üí° Ejecutores compatibles: Synapse X, Fluxus, Script-Ware, etc.")
    end
end)

-- Bot√≥n para refrescar manualmente la lista
InfoPlayers:AddButton("üîÑ Refrescar Lista", function()
    playersDropdown:Clear()
    for _, p in ipairs(getCurrentPlayers()) do
        playersDropdown:Add(p.DisplayName .. " | " .. p.Name)
    end
    print("üîÑ Lista de jugadores actualizada")
end)

print("‚úÖ Sistema de informaci√≥n de jugadores cargado")
print("üìã Jugadores disponibles:", #getCurrentPlayers())

local Blacklist = mainTab:AddFolder("  Black List Players")

local Discord = mainTab:AddFolder("  Discord Funtion")

local Scriptsexternal = mainTab:AddFolder("  Scripts Externals")

local Scriptscrackeds = mainTab:AddFolder("  Scripts Crackeds")

local FarmTab = window:AddTab("Farm")

local MisctAB = window:AddTab("Misc")

local gymsTab = window:AddTab("Gyms")

local CalculatorTab = window:AddTab("Calculator")

local GiftTab = window:AddTab("Gift")

local CrystalsTab = window:AddTab("Crystals")

local StatsTab = window:AddTab("Stats")

local MeTab = window:AddTab("Stats V2")

local KillerTab = window:AddTab("Killer")

local ExtrasTab = window:AddTab("Extras")

local InfoTab = window:AddTab("Music")

local TeleportTab = window:AddTab("Teleport")

local CreditsTab = window:AddTab("Credits")
