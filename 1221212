--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TeleportService = game:GetService("TeleportService")
local StarterGui = game:GetService("StarterGui")

local LocalPlayer = Players.LocalPlayer

--// UI
local Fluent = loadstring(game:HttpGet("https://github.com/dawid-scripts/Fluent/releases/latest/download/main.lua"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = Fluent:CreateWindow({
	Title = "Eclipse Hub",
	SubTitle = "Build A Boat For Treasure",
	TabWidth = 160,
	Size = UDim2.fromOffset(580, 460),
	Acrylic = true,
	Theme = "Dark",
	MinimizeKey = Enum.KeyCode.LeftControl
})

local Tabs = {
	Main = Window:AddTab({ Title = "Main", Icon = "home" }),
	Player = Window:AddTab({ Title = "Player", Icon = "user" }),
	Teleport = Window:AddTab({ Title = "Teleport", Icon = "map-pin" }),
	Misc = Window:AddTab({ Title = "Misc", Icon = "settings" })
}

--// Toggles
local InfiniteJump = false
local AutoFarm = false
local WaterGodmode = false
local AutoCommonChest = false
local AutoUncommonChest = false
local AutoRareChest = false
local AutoEpicChest = false
local AutoLegendaryChest = false
local AutoWinterChest = false

--// Infinite Jump
Tabs.Main:AddToggle("InfJumpToggle", {
	Title = "Infinite Jump",
	Default = false,
	Callback = function(state)
		InfiniteJump = state
		if state then
			task.spawn(function()
				while InfiniteJump do
					UserInputService.JumpRequest:Connect(function()
						if InfiniteJump and LocalPlayer.Character then
							local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
							if hum then
								hum:ChangeState(Enum.HumanoidStateType.Jumping)
							end
						end
					end)
					RunService.Heartbeat:Wait()
				end
			end)
		end
	end
})

--// Auto Farm
Tabs.Main:AddToggle("AutoFarmToggle", {
	Title = "Auto Farm",
	Default = false,
	Callback = function(state)
		AutoFarm = state
		if state then
			task.spawn(function()
				local Stages = workspace:WaitForChild("BoatStages"):WaitForChild("NormalStages")
				local ClaimGold = workspace:WaitForChild("ClaimRiverResultsGold")

				while AutoFarm do
					local bv = Instance.new("BodyVelocity")
					bv.Velocity = Vector3.zero

					if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
						bv.Parent = LocalPlayer.Character.HumanoidRootPart
					end

					for i = 1, 9 do
						if not AutoFarm then break end

						if LocalPlayer.Character and Stages["CaveStage" .. i] then
							LocalPlayer.Character.HumanoidRootPart.CFrame =
								Stages["CaveStage" .. i].DarknessPart.CFrame

							RunService.Heartbeat:Wait()
							task.wait(i == 1 and 6 or 3)
							ClaimGold:FireServer()
						end
					end

					if AutoFarm and LocalPlayer.Character then
						LocalPlayer.Character:Remove()
						repeat RunService.Heartbeat:Wait()
						until LocalPlayer.Character or not AutoFarm
					end

					if bv then bv:Destroy() end
				end
			end)
		end
	end
})

--// Water Godmode
Tabs.Main:AddToggle("WaterGodmodeToggle", {
	Title = "Water Godmode",
	Default = false,
	Callback = function(state)
		WaterGodmode = state
		if state then
			RunService.Stepped:Connect(function()
				if WaterGodmode and LocalPlayer.Character then
					local wd = LocalPlayer.Character:FindFirstChild("WaterDetector")
					if wd then wd:Destroy() end
				end
			end)
		end
	end
})

--// Auto Chests
local function AutoChest(toggleVar, chestName)
	RunService.Stepped:Connect(function()
		if toggleVar() then
			workspace.ItemBoughtFromShop:InvokeServer(chestName, 1)
		end
	end)
end

Tabs.Main:AddToggle("CommonChestToggle", {
	Title = "Auto Common Chest",
	Default = false,
	Callback = function(v) AutoCommonChest = v end
})
AutoChest(function() return AutoCommonChest end, "Common Chest")

Tabs.Main:AddToggle("UncommonChestToggle", {
	Title = "Auto Uncommon Chest",
	Default = false,
	Callback = function(v) AutoUncommonChest = v end
})
AutoChest(function() return AutoUncommonChest end, "Uncommon Chest")

Tabs.Main:AddToggle("RareChestToggle", {
	Title = "Auto Rare Chest",
	Default = false,
	Callback = function(v) AutoRareChest = v end
})
AutoChest(function() return AutoRareChest end, "Rare Chest")

Tabs.Main:AddToggle("EpicChestToggle", {
	Title = "Auto Epic Chest",
	Default = false,
	Callback = function(v) AutoEpicChest = v end
})
AutoChest(function() return AutoEpicChest end, "Epic Chest")

Tabs.Main:AddToggle("LegendaryChestToggle", {
	Title = "Auto Legendary Chest",
	Default = false,
	Callback = function(v) AutoLegendaryChest = v end
})
AutoChest(function() return AutoLegendaryChest end, "Legendary Chest")

Tabs.Main:AddToggle("WinterChestToggle", {
	Title = "Auto Winter Chest",
	Default = false,
	Callback = function(v)
		AutoWinterChest = v
		if v then
			task.spawn(function()
				while AutoWinterChest do
					workspace.ItemBoughtFromShop:InvokeServer(
						"Winter Chest",
						math.floor(LocalPlayer.Data.Gold.Value / 100)
					)
					RunService.Heartbeat:Wait()
				end
			end)
		end
	end
})

--// Final
SaveManager:SetLibrary(Fluent)
InterfaceManager:SetLibrary(Fluent)
InterfaceManager:BuildInterfaceSection(Tabs.Misc)
SaveManager:BuildConfigSection(Tabs.Misc)

Window:SelectTab(1)

Fluent:Notify({
	Title = "Eclipse Hub",
	Content = "Loaded successfully!",
	Duration = 5
})

SaveManager:LoadAutoloadConfig()
